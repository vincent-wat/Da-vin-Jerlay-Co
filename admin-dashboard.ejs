<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
        }
        .btn {
            margin: 4px 2px;
            cursor: pointer;
            border: none;
            color: white;
            padding: 10px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
        .btn-edit {
            background-color: #4CAF50;
        }
        .btn-cancel {
            background-color: #f44336;
        }
        .edit-form {
            display: none;
        }
    </style>
</head>
<body>
    <%- include('header') %>

    <main>
        <section id="admin-details">
            <h1>Welcome, <%= user.nickname %> (Admin)!</h1>
            <p>Email: <%= user.email %></p>
        </section>
        <section id="transaction-management">
            <h2>Transaction Management</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nickname</th>
                        <th>Email</th>
                        <th>Action</th>
                        <th>Room Type</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Timestamp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% transactions.forEach(transaction => { %>
                        <tr>
                            <td><%= transaction.id %></td>
                            <td><%= transaction.nickname %></td>
                            <td><%= transaction.email %></td>
                            <td><%= transaction.action %></td>
                            <td><%= transaction.room_type %></td>
                            <td><%= transaction.check_in %></td>
                            <td><%= transaction.check_out %></td>
                            <td><%= transaction.timestamp %></td>
                            <td>
                                <button onclick="toggleEditForm('<%= transaction.id %>')" class="btn btn-edit">Edit</button>
                                <button onclick="confirmCancel('<%= transaction.id %>')" class="btn btn-cancel">Cancel</button>
                            </td>
                        </tr>
                        <tr class="edit-form" id="edit-form-<%= transaction.id %>">
                            <td colspan="9">
                                <form action="/edit-transaction" method="POST">
                                    <input type="hidden" name="transactionId" value="<%= transaction.id %>">
                                    <label for="checkIn-<%= transaction.id %>">Check-in:</label>
                                    <input type="date" id="checkIn-<%= transaction.id %>" name="checkIn" value="<%= transaction.check_in %>" required>
                                    <label for="checkOut-<%= transaction.id %>">Check-out:</label>
                                    <input type="date" id="checkOut-<%= transaction.id %>" name="checkOut" value="<%= transaction.check_out %>" required>
                                    <label for="roomType-<%= transaction.id %>">Room Type:</label>
                                    <select id="roomType-<%= transaction.id %>" name="roomType" required>
                                        <option value="1bed" <%= transaction.room_type === '1bed' ? 'selected' : '' %>>1 Bed</option>
                                        <option value="2bed" <%= transaction.room_type === '2bed' ? 'selected' : '' %>>2 Bed</option>
                                        <option value="3bed" <%= transaction.room_type === '3bed' ? 'selected' : '' %>>3 Bed</option>
                                        <option value="4bed" <%= transaction.room_type === '4bed' ? 'selected' : '' %>>4 Bed</option>
                                        <option value="deluxe" <%= transaction.room_type === 'deluxe' ? 'selected' : '' %>>Deluxe</option>
                                        <option value="suite" <%= transaction.room_type === 'suite' ? 'selected' : '' %>>Suite</option>
                                    </select>
                                    <button type="submit" class="btn btn-edit">Save Changes</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </section>
        <section id="user-management">
            <h2>User Management</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nickname</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.id %></td>
                            <td><%= user.nickname %></td>
                            <td><%= user.email %></td>
                            <td>
                                <button onclick="toggleUserEditForm('<%= user.id %>')" class="btn btn-edit">Edit</button>
                                <button onclick="confirmDeleteUser('<%= user.id %>')" class="btn btn-cancel">Delete</button>
                            </td>
                        </tr>
                        <tr class="edit-form" id="user-edit-form-<%= user.id %>">
                            <td colspan="4">
                                <form action="/edit-user" method="POST">
                                    <input type="hidden" name="userId" value="<%= user.id %>">
                                    <label for="nickname-<%= user.id %>">Nickname:</label>
                                    <input type="text" id="nickname-<%= user.id %>" name="nickname" value="<%= user.nickname %>" required>
                                    <label for="email-<%= user.id %>">Email:</label>
                                    <input type="email" id="email-<%= user.id %>" name="email" value="<%= user.email %>" required>
                                    <button type="submit" class="btn btn-edit">Save Changes</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Hotel. All Rights Reserved.</p>
    </footer>
    <script>
        function toggleEditForm(id) {
            const form = document.getElementById(`edit-form-${id}`);
            form.style.display = form.style.display === 'none' ? 'table-row' : 'none';
        }

        function confirmCancel(id) {
            if (confirm('Are you sure you want to cancel this transaction?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/cancel-transaction';

                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'transactionId';
                input.value = id;

                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        }

        function toggleUserEditForm(id) {
            const form = document.getElementById(`user-edit-form-${id}`);
            form.style.display = form.style.display === 'none' ? 'table-row' : 'none';
        }

        function confirmDeleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/delete-user';

                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'userId';
                input.value = id;

                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>
